{
    "type": "DataSuggest",
    "body": "\ndatasource = prism.activeDashboard.datasource\ntitle = datasource.title\nvar prismHasInternalHttp = prism.$injector.has('base.factories.internalHttp');\nvar $internalHttp = prism.$injector.get('base.factories.internalHttp');\n\nfunction uuidv4() {\n    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n\nif (datasource.ApiToken !== undefined && datasource.ApiToken != '') {\n    callNoteBook()\n} else {\n    datasource.ApiToken = ''\n    const config = {\n        url: prism.proxyurl + '/api/v1/authentication/tokens/api',\n        method: 'GET',\n        contentType: 'application/json',\n        async: false,\n    }\n\n    res = $internalHttp(config, false)\n    res.then(function (response) {\n        console.log(response)\n        datasource.ApiToken = response.data.token\n        callNoteBook()\n    })\n}\nquid = uuidv4()\nfunction callNoteBook() {\n    requestStructure = {\n        \"datasource\": { title: 'AITransformation' },\n        \"metadata\": [\n            {\n                \"jaql\": {\n                    \"table\": \"Empty\",\n                    \"column\": \"Empty\",\n                    \"dim\": \"[Empty.Empty]\",\n                    \"filter\": { \"contains\": new Date() },\n                    \"datatype\": \"text\",\n                    \"merged\": true,\n                    \"title\": \"Empty\"\n                },\n                \"instanceid\": \"00128-E54A-D4\",\n                \"field\": {\n                    \"id\": \"[Empty.Empty]\",\n                    \"index\": 0\n                }\n            }\n        ],\n        \"count\": 1,\n        \"offset\": 0,\n        \"transformData\": [\n            {\n                \"transformDataFormat\": {\n                    \"CustomCodeTransformerFormatType\": \"Json\"\n                },\n                \"customCode\": {\n                    \"codePath\": \"/work/storage_notebooks/custom_code_notebooks/notebooks/DataSuggest1/DataSuggest1.ipynb\",\n                    \"cellsDisable\": [\n                        0\n                    ],\n                    \"language\": \"Python\",\n                    \"serverUrl\": \"customcode:8888\",\n                    \"mode\": \"Post\",\n                    \"additionalParameters\": \"{\" +\n                        \"\\\"model_name\\\":\\\"\" + title +\n                        \"\\\",\\\"widgetId\\\":\\\"\" + quid +\n                        \"\\\",\\\"table_name\\\":\\\"\" + payload.data.table +\n                        \"\\\",\\\"cookie\\\":\\\"\" + datasource.ApiToken + \"\\\"}\"\n                }\n            }\n        ],\n        \"isMaskedResult\": true,\n        \"format\": \"json\",\n        \"widgetType\": \"fakewidget\",\n        \"by\": \"widget\",\n        \"dashboard\": \"639ecc035c717c0034a9bd30;BloxAI\",\n        \"widget\": \"639ee12b7ccfa60034cd5d40;Generated\",\n        \"queryGuid\": \"515C9-2FE3-BEA7-AA89-6F08-D76F-7388-AE6C-5\"\n    }\n\n    const config = {\n        url: prism.proxyurl + '/api/datasources/' + title + '/jaql',\n        method: 'POST',\n        data: JSON.stringify(requestStructure),\n        contentType: 'application/json',\n        async: false,\n    };\n\n\n\n    document.getElementById('outputContainer').innerHTML = \"<H1>Looking for the response to your question</H1>\"\n    res = $internalHttp(config, false);\n    res.then(function (response) {\n        values = response.data.values\n        data = values[0][0]['data']\n        document.getElementById('outputContainer').innerHTML = data\n        payload.widget.lastResult = data\n    })\n}",
    "snippet": {
        "type": "DataSuggest",
        "title": "title"
    }
}